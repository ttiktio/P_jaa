<!-- index.html -->
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Wordle - เกมทายคำ (A2–C1 + Random)</title>
  <style>
    :root{
      --tile: clamp(44px, 10.5vw, 60px);
      --gap: 8px;
      --container-w: min(520px, 92vw);
    }
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html,body{height:100%}
    body{
      font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
      min-height:100vh;display:flex;justify-content:center;align-items:center;
      padding:20px; padding-bottom:calc(20px + env(safe-area-inset-bottom));
      color:#1f2937;
    }
    .container{
      width:var(--container-w); background:#fff; border-radius:20px;
      box-shadow:0 20px 60px rgba(0,0,0,.3); display:flex; flex-direction:column;
      max-height:calc(100vh - 40px); overflow:hidden;
    }
    header{
      padding:14px 16px; border-bottom:1px solid #e5e7eb; background:#fff;
      display:flex; align-items:center; gap:10px; justify-content:space-between;
    }
    h1{font-size:1.4rem; font-weight:800; letter-spacing:.3px; color:#111827}
    .controls{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
    select,button{
      border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; background:#f9fafb;
      font-weight:600; cursor:pointer; color:#111827;
    }
    button.primary{
      background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:#fff; border:none;
    }
    .subtitle{
      padding:8px 16px; background:#fafafa; color:#6b7280; font-size:.9rem; border-bottom:1px solid #f1f5f9
    }
    .content{
      display:flex; flex-direction:column; gap:12px;
      padding:14px 12px; overflow:auto;
    }
    .game-board{display:flex; flex-direction:column; gap:var(--gap); align-items:center}
    .row{display:flex; gap:var(--gap); justify-content:center}
    .tile{
      width:var(--tile); height:var(--tile);
      border:2px solid #d3d6da; border-radius:8px;
      display:grid; place-items:center; font-size:calc(var(--tile) * .38);
      font-weight:800; text-transform:uppercase; background:#fff; color:#111827;
      transition:transform .15s ease, background-color .2s ease, border-color .2s ease;
      user-select:none;
    }
    .tile.filled{border-color:#878a8c; animation:pop .09s ease}
    .tile.correct{background:#6aaa64; border-color:#6aaa64; color:#fff}
    .tile.present{background:#c9b458; border-color:#c9b458; color:#fff}
    .tile.absent{background:#787c7e; border-color:#787c7e; color:#fff}
    .tile.flip{animation:flip .45s ease}
    @keyframes pop{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
    @keyframes flip{0%{transform:rotateX(0)}50%{transform:rotateX(90deg)}100%{transform:rotateX(0)}}
    .keyboard-wrap{
      position:sticky; bottom:0; background:#fff; border-top:1px solid #e5e7eb;
      padding:10px 8px; padding-bottom:calc(10px + env(safe-area-inset-bottom));
    }
    .keyboard{display:flex; flex-direction:column; gap:8px}
    .keyboard-row{display:flex; gap:6px; justify-content:center}
    .key{
      background:#e5e7eb; border:none; border-radius:8px;
      padding:clamp(10px,2.5vw,14px); min-width:clamp(34px, 8.5vw, 46px);
      font-size:.95rem; font-weight:800; color:#111827; text-transform:uppercase; cursor:pointer;
      user-select:none;
    }
    .key:active{transform:scale(.97)}
    .key.wide{min-width:clamp(64px, 18vw, 90px); font-size:.9rem}
    .key.correct{background:#6aaa64; color:#fff}
    .key.present{background:#c9b458; color:#fff}
    .key.absent{background:#787c7e; color:#fff}
    .stats{ text-align:center; color:#6b7280; font-size:.92rem; padding:8px 12px 2px }
    .message{
      position:fixed; top:16px; left:50%; transform:translateX(-50%);
      background:#111827; color:#fff; padding:10px 14px; border-radius:10px; font-weight:700;
      display:none; z-index:10;
    }
    .message.show{display:block}
    .message.win{background:#6aaa64}
    .message.lose{background:#ef4444}
    @media (max-width:420px){ h1{font-size:1.2rem} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>WORDLE (A2–C1)</h1>
      <div class="controls">
        <label for="levelSel" style="font-size:.9rem;color:#6b7280;font-weight:700;">ระดับ</label>
        <select id="levelSel" aria-label="เลือกระดับคำศัพท์">
          <option value="RANDOM">Random</option>
          <option value="A2">A2</option>
          <option value="B1">B1</option>
          <option value="B2">B2</option>
          <option value="C1" selected>C1</option>
        </select>
        <button id="btnNew" class="primary">เริ่มเกมใหม่</button>
      </div>
    </header>

    <div class="subtitle" id="subtitle">ทายคำภาษาอังกฤษ 5 ตัวอักษร • ระดับ: C1 • โอกาส 6 ครั้ง</div>

    <div class="content">
      <div class="game-board" id="gameBoard"></div>
      <div class="stats" id="stats">พิมพ์หรือแตะปุ่มเพื่อเริ่มเล่น</div>
    </div>

    <div class="keyboard-wrap">
      <div class="keyboard" id="keyboard"></div>
    </div>
  </div>

  <div class="message" id="message"></div>

  <script>
    const WORD_LENGTH = 5;
    const MAX_GUESSES = 6;

    // STATE
    let LEVEL = localStorage.getItem('wordle-level') || 'C1';
    let lastPickedLevel = LEVEL;   // สำหรับแสดงเมื่อสุ่ม Random
    let targetWord = '';
    let currentGuess = '';
    let currentRow = 0;
    let isAnimating = false;
    let gameOver = false;
    let wordList = [];

    // DOM
    const $ = (s)=>document.querySelector(s);
    const gameBoard = $('#gameBoard');
    const keyboard = $('#keyboard');
    const message = $('#message');
    const stats = $('#stats');
    const subtitle = $('#subtitle');
    const levelSel = $('#levelSel');

    const keyboardLayout = [
      ['Q','W','E','R','T','Y','U','I','O','P'],
      ['A','S','D','F','G','H','J','K','L'],
      ['ENTER','Z','X','C','V','B','N','M','BACK']
    ];

    levelSel.value = LEVEL;
    $('#btnNew').addEventListener('click', ()=> newGame(true));
    levelSel.addEventListener('change', async (e)=>{
      LEVEL = e.target.value;
      localStorage.setItem('wordle-level', LEVEL);
      await newGame(true);
    });

    function setSubtitle(){
      // ถ้าโหมด Random จะแจ้งวงเล็บระดับที่สุ่มได้ด้วย
      const lvText = (LEVEL==='RANDOM') ? `RANDOM (รอบนี้: ${lastPickedLevel})` : LEVEL;
      subtitle.textContent = `ทายคำภาษาอังกฤษ ${WORD_LENGTH} ตัวอักษร • ระดับ: ${lvText} • โอกาส ${MAX_GUESSES} ครั้ง`;
    }

    function createBoard(){
      gameBoard.innerHTML = '';
      for (let r=0;r<MAX_GUESSES;r++){
        const row = document.createElement('div');
        row.className='row'; row.id=`row-${r}`;
        for (let c=0;c<WORD_LENGTH;c++){
          const tile = document.createElement('div');
          tile.className='tile'; tile.id=`tile-${r}-${c}`;
          row.appendChild(tile);
        }
        gameBoard.appendChild(row);
      }
    }

    function createKeyboard(){
      keyboard.innerHTML='';
      keyboardLayout.forEach(line=>{
        const row = document.createElement('div');
        row.className='keyboard-row';
        line.forEach(k=>{
          const btn = document.createElement('button');
          btn.className='key'; btn.textContent = (k==='BACK'?'⌫':k);
          btn.id=`key-${k}`;
          if (k==='ENTER' || k==='BACK') btn.classList.add('wide');
          btn.addEventListener('click', ()=> handleKey(k));
          row.appendChild(btn);
        });
        keyboard.appendChild(row);
      });
    }

    async function loadWords(){
      // โหมดสุ่ม: สุ่มระดับหนึ่งครั้ง/ต่อเกม
      let pickLevel = LEVEL;
      if (LEVEL === 'RANDOM') {
        const levels = ['A2','B1','B2','C1'];
        pickLevel = levels[Math.floor(Math.random()*levels.length)];
      }
      lastPickedLevel = pickLevel;

      const file = `words-${pickLevel.toLowerCase()}.json?v=${Date.now()}`;
      try{
        const res = await fetch(file, {cache:'no-store'});
        if (!res.ok) throw new Error('Cannot fetch list');
        const data = await res.json();
        const arr = Array.isArray(data) ? data : (data.words || []);
        wordList = arr.map(w=>String(w).toUpperCase())
                      .filter(w=>w.length===WORD_LENGTH && /^[A-Z]+$/.test(w));
        if (!wordList.length) throw new Error('Empty list');
      }catch(err){
        // fallback เริ่มต้นเผื่อยังไม่วางไฟล์ JSON
        const fallback = {
          A2: ["ABOUT","AFTER","AGAIN","APPLE","BEACH","BLACK","BREAD","BRING","BROWN","CHAIR","DRINK","EARLY","GREEN","HEART","HOUSE","LEARN","LIGHT","LOCAL","MONEY","MONTH","MOUTH","MUSIC","NIGHT","OTHER","PLANT","RIGHT","SMALL","SMILE","SOUTH","SPACE","SPEAK","START","STONE","STUDY","SWEET","TABLE","TEACH","THEIR","THERE","THESE","THING","THINK","THOSE","THREE","TODAY","UNDER","WATER","WHERE","WHICH","WORLD","WRITE"],
          B1: ["AWARE","BASIC","BEING","BREAK","CLEAR","DOUBT","ERROR","EXTRA","FAULT","FINAL","FOCUS","FORCE","FRAME","FRESH","FRONT","GIANT","GRADE","GRANT","GROUP","GUESS","HUMAN","IDEAL","IMAGE","INNER","ISSUE","LABEL","LARGE","LEAST","LEVEL","LIMIT","LOCAL","LOGIC","LUCKY","MAJOR","MATCH","MEDIA","METAL","MODEL","MOTOR","NOVEL","OCEAN","OFFER","OFTEN","PIECE","PILOT","PLACE","PLAIN","PLANT","PLATE","POINT","POWER","PRESS","PRICE","PRIME","PRINT","PRIOR","PRIZE","PROOF","PROVE","QUICK","QUIET","RADIO","RAISE","REACH","READY","REFER","RIGHT","RIVAL","RIVER","SCENE","SCORE","SENSE","SERVE","SHAPE","SHIFT","SHORT","SIGHT","SKILL","SMALL","SOLVE","SOUND","SPACE","SPEAK","SPEED","SPEND","STAFF","STAGE","STAND","STATE","STEEL","STICK","STILL","STONE","STORE","STORM","STORY","STYLE","SUPER","TABLE","TEETH","THEME","TITLE","TOUCH","TOUGH","TRACK","TRADE","TRAIN","TREND","TRIAL","TRUCK","TRUST","TRUTH","UNDER","UNION","UNTIL","URBAN","USUAL","VALUE","VISIT","VOCAL","VOICE","WATCH","WHOLE","WOMAN","YOUTH"],
          B2: ["ACUTE","ADAPT","ALIGN","ALIVE","AMEND","ARISE","AVERT","BLEND","BRISK","CRISP","DENSE","ELITE","EQUAL","EQUIP","ETHIC","FEIGN","FLAIR","FLUID","FRAIL","FRAUD","GRASP","GRAVE","HASTE","IMPLY","IRATE","LEERY","LITHE","LOFTY","LUCID","NOBLE","OCCUR","OPTIC","OVERT","PIQUE","PLUSH","POISE","PRIOR","PRONE","PROXY","QUOTA","RIGID","ROGUE","SEVER","SHREW","SLACK","SOLEMN","SPAWN","SPIRE","SPURN","STARK","STEEP","STERN","SUAVE","SUITE","TANGY","TENSE","TERSE","TIDAL","TORCH","TRITE","VALET","VAUNT","VIGOR","VOGUE","WIELD","YIELD"],
          C1: ["PITHY","LURID","BANAL","CAVIL","DEMUR","INANE","WRYLY","TERSE","TACIT","STOIC","TRITE","TEPID","VEXED","SLYLY","POSIT","GUILE","PRUDE","ROGUE","KNACK","PLAID","RIGOR","LITHE","LEERY","VIGOR","ICILY","DROLL","SURLY","RARER","TUMID","TURBO"]
        };
        wordList = (fallback[pickLevel]||fallback.C1).filter(w=>w.length===WORD_LENGTH);
      }

      targetWord = wordList[Math.floor(Math.random()*wordList.length)];
      console.log('คำที่ต้องทาย:', targetWord, '(ระดับ:', lastPickedLevel, ')');
    }

    function handleKey(key){
      if (gameOver || isAnimating) return;
      if (key==='BACK'){
        if (currentGuess.length>0){
          currentGuess = currentGuess.slice(0,-1);
          updateBoard();
        }
        return;
      }
      if (key==='ENTER'){
        if (currentGuess.length!==WORD_LENGTH){
          showMessage(`กรุณากรอกคำให้ครบ ${WORD_LENGTH} ตัวอักษร`); return;
        }
        if (!wordList.includes(currentGuess)){
          showMessage('ไม่มีคำนี้ในรายการ'); return;
        }
        checkGuess();
        return;
      }
      if (key.length===1 && key>='A' && key<='Z'){
        if (currentGuess.length<WORD_LENGTH){
          currentGuess += key;
          updateBoard();
        }
      }
    }

    function updateBoard(){
      for (let i=0;i<WORD_LENGTH;i++){
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        tile.textContent = currentGuess[i] || '';
        tile.classList.toggle('filled', !!currentGuess[i]);
      }
    }

    function checkGuess(){
      const guess = currentGuess;
      const target = targetWord;

      const counts = {};
      for (const ch of target) counts[ch] = (counts[ch]||0)+1;
      const results = Array(WORD_LENGTH).fill('absent');

      // correct
      for (let i=0;i<WORD_LENGTH;i++){
        if (guess[i]===target[i]){
          results[i]='correct';
          counts[guess[i]]--;
        }
      }
      // present
      for (let i=0;i<WORD_LENGTH;i++){
        if (results[i]==='correct') continue;
        const ch = guess[i];
        if (counts[ch]>0){
          results[i]='present';
          counts[ch]--;
        }
      }

      isAnimating = true;
      for (let i=0;i<WORD_LENGTH;i++){
        const tile = document.getElementById(`tile-${currentRow}-${i}`);
        const letter = guess[i];
        setTimeout(()=> tile.classList.add('flip'), i*180);
        setTimeout(()=>{
          tile.classList.remove('flip');
          tile.classList.add(results[i]);
          updateKeyColor(letter, results[i]);
        }, i*180 + 220);
      }

      const doneAt = WORD_LENGTH*180 + 260;
      setTimeout(()=>{
        if (guess===target){
          gameOver = true;
          showMessage('🎉 ยินดีด้วย! คุณครูจ๋าเก่งมากก!!','win');
          updateStats(`คุณทายถูกใน ${currentRow+1} ครั้ง`);
        } else if (currentRow===MAX_GUESSES-1){
          gameOver = true;
          showMessage(`คำที่ถูกต้องคือ: ${target}`,'lose');
          updateStats('ลองใหม่อีกครั้ง!');
        } else {
          currentRow++;
          currentGuess='';
        }
        isAnimating = false;
      }, doneAt);
    }

    function updateKeyColor(letter, result){
      const key = document.getElementById(`key-${letter}`);
      if (!key) return;
      const priority = {absent:1, present:2, correct:3};
      const cur = priority[key.dataset.state] || 0;
      const nxt = priority[result] || 0;
      if (nxt>cur){
        key.dataset.state = result;
        key.className = `key ${result}${key.classList.contains('wide')?' wide':''}`;
      }
    }

    function showMessage(text, type=''){
      message.textContent = text;
      message.className = `message show ${type}`;
      clearTimeout(showMessage._t);
      showMessage._t = setTimeout(()=> message.classList.remove('show'), 2400);
    }

    function updateStats(text){ stats.textContent = text; }

    async function newGame(force=false){
      // reset
      currentGuess=''; currentRow=0; gameOver=false; isAnimating=false;
      await loadWords();
      setSubtitle();
      createBoard();
      createKeyboard();
      updateStats('พิมพ์หรือแตะปุ่มเพื่อเริ่มเล่น');
    }

    document.addEventListener('keydown',(e)=>{
      const k = e.key.toUpperCase();
      if (k==='BACKSPACE') handleKey('BACK');
      else if (k==='ENTER') handleKey('ENTER');
      else if (k.length===1 && k>='A' && k<='Z') handleKey(k);
    }, {passive:true});

    // boot
    newGame();
  </script>
</body>
</html>
